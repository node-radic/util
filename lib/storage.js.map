{"version":3,"file":"storage.js","sourceRoot":"","sources":["storage.ts"],"names":[],"mappings":"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","sourcesContent":["import { defined } from './general'\n\nexport enum StorageProvider {\n    LOCAL, SESSION, COOKIE\n}\n\nexport class Storage\n{\n    static bags: {[name: string]: IStorageBag} = {}\n\n    static hasBag( name: string ): boolean {\n        return typeof Storage.bags[name] !== 'undefined';\n    }\n\n    static createBag( name: string, provider: StorageProvider ): IStorageBag {\n        if ( Storage.hasBag(name) ) {\n            throw new Error('StorageBag ' + name + ' already exists');\n        }\n        return Storage.bags[name] = new StorageBag(Storage.make(name, provider));\n    }\n\n    static getBag( name: string ): IStorageBag {\n        if ( !Storage.hasBag(name) ) {\n            throw new Error('StorageBag ' + name + ' does not exist');\n        }\n        return Storage.bags[name];\n    }\n\n    private static make( name: string, provider: StorageProvider ): IStorageProvider {\n        if ( provider === StorageProvider.COOKIE ) return new CookieStorage(name);\n        if ( provider === StorageProvider.LOCAL ) return new LocalStorage(name);\n        if ( provider === StorageProvider.SESSION ) return new SessionStorage(name);\n        throw new Error('Storage provider could not be maked. ... ?')\n    }\n\n    static isSupportedProvider( provider: IStorageBag ): boolean {\n        if ( provider instanceof LocalStorage ) {\n            return defined(window.localStorage)\n        }\n        if ( provider instanceof SessionStorage ) {\n            return defined(window.localStorage)\n        }\n        if ( provider instanceof CookieStorage ) {\n            return defined(window.document.cookie)\n        }\n    }\n}\n\nexport interface IStorageProvider\n{\n    length: number;\n    onStoreEvent( callback: Function );\n    clear(): void;\n    getItem( key: string ): any;\n    key( index: number ): string;\n    removeItem( key: string ): void;\n    setItem( key: string, data: string ): void;\n    hasItem( key: string ): boolean;\n    getSize( key: any ): string;\n}\n\nexport interface IStorageBag\n{\n    get( key: any, options?: any ): any\n    set( key: any, val: any, options?: any );\n    has( key: any ): boolean;\n    on( callback: any );\n    del( key: any );\n    clear();\n    getSize( key: any );\n}\n\nexport class StorageBag implements IStorageBag\n{\n    provider: IStorageProvider;\n\n    constructor( provider: IStorageProvider ) {\n        this.provider = provider;\n    }\n\n    on( callback: Function ) {\n        this.provider.onStoreEvent(callback);\n    }\n\n    set( key: any, val: any, options?: any ) {\n        var options: any = _.merge({ json : true, expires : false }, options);\n        if ( options.json ) {\n            val = JSON.stringify(val);\n        }\n        if ( options.expires ) {\n            var now = Math.floor((Date.now() / 1000) / 60);\n            this.provider.setItem(key + ':expire', now + options.expires);\n        }\n        this.provider.setItem(key, val);\n    }\n\n    get( key: any, options?: any ) {\n        var options: any = _.merge({ json : true, def : null }, options);\n\n        if ( !key ) {\n            return options.def;\n        }\n\n        if ( _.isString(this.provider.getItem(key)) ) {\n            if ( _.isString(this.provider.getItem(key + ':expire')) ) {\n                var now     = Math.floor((Date.now() / 1000) / 60);\n                var expires = parseInt(this.provider.getItem(key + ':expire'));\n                if ( now > expires ) {\n                    this.del(key);\n                    this.del(key + ':expire');\n                }\n            }\n        }\n\n        var val: any = this.provider.getItem(key);\n\n        if ( !val || defined(val) && val == null ) {\n            return options.def;\n        }\n\n        if ( options.json ) {\n            return JSON.parse(val);\n        }\n        return val;\n    }\n\n    has( key ) {\n        return this.provider.hasItem(key);\n    }\n\n\n    /**\n     * Delete a value from the storage\n     * @param {string|number} key\n     */\n    del( key ) {\n        this.provider.removeItem(key);\n    }\n\n    /**\n     * Clear the storage, will clean all saved items\n     */\n    clear() {\n        this.provider.clear();\n    }\n\n\n    /**\n     * Get total localstorage size in MB. If key is provided,\n     * it will return size in MB only for the corresponding item.\n     * @param [key]\n     * @returns {string}\n     */\n    getSize( key: any ): string {\n        return this.provider.getSize(key);\n    }\n}\n\n\nexport abstract class BaseStorageProvider\n{\n    constructor( public name: string ) {}\n}\n\nexport class LocalStorage extends BaseStorageProvider implements IStorageProvider\n{\n    hasItem( key: string ): boolean {\n        return window.localStorage.getItem(key) !== null;\n    }\n\n    get length(): number {\n        return window.localStorage.length;\n    }\n\n    getSize( key: any ): string {\n        key = key || false;\n        if ( key ) {\n            return ((window.localStorage[x].length * 2) / 1024 / 1024).toFixed(2);\n        }\n        else {\n            var total = 0;\n            for ( var x in window.localStorage ) {\n                total += (window.localStorage[x].length * 2) / 1024 / 1024;\n            }\n            return total.toFixed(2);\n        }\n    }\n\n    onStoreEvent( callback: Function ) {\n        if ( window.addEventListener ) {\n            window.addEventListener(\"storage\", <any> callback, false);\n        }\n        else {\n            window['attachEvent'](\"onstorage\", <any> callback);\n        }\n    }\n\n    clear(): void {\n        window.localStorage.clear();\n    }\n\n    getItem( key: string ): any {\n        return window.localStorage.getItem(key);\n    }\n\n    key( index: number ): string {\n        return window.localStorage.key(index);\n    }\n\n    removeItem( key: string ): void {\n        window.localStorage.removeItem(key);\n    }\n\n    setItem( key: string, data: string ): void {\n        window.localStorage.setItem(key, data);\n    }\n}\n\nexport class SessionStorage extends BaseStorageProvider implements IStorageProvider\n{\n\n    hasItem( key: string ): boolean {\n        return window.localStorage.getItem(key) !== null;\n    }\n\n    get length() {\n        return window.sessionStorage.length;\n    }\n\n    getSize( key: any ): string {\n        key = key || false;\n        if ( key ) {\n            return ((window.sessionStorage[x].length * 2) / 1024 / 1024).toFixed(2);\n        }\n        else {\n            var total = 0;\n            for ( var x in window.sessionStorage ) {\n                total += (window.sessionStorage[x].length * 2) / 1024 / 1024;\n            }\n            return total.toFixed(2);\n        }\n    }\n\n    onStoreEvent( callback: Function ) {\n        if ( window.addEventListener ) {\n            window.addEventListener(\"storage\", <any> callback, false);\n        }\n        else {\n            window['attachEvent'](\"onstorage\", <any> callback);\n        }\n    }\n\n    clear(): void {\n        window.sessionStorage.clear();\n    }\n\n    getItem( key: string ): any {\n        return window.sessionStorage.getItem(key);\n    }\n\n    key( index: number ): string {\n        return window.sessionStorage.key(index);\n    }\n\n    removeItem( key: string ): void {\n        window.sessionStorage.removeItem(key);\n    }\n\n    setItem( key: string, data: string ): void {\n        window.sessionStorage.setItem(key, data);\n    }\n}\n\nexport class CookieStorage extends BaseStorageProvider implements IStorageProvider\n{\n    get length() {\n        return this.keys().length;\n    }\n\n    getSize( key: any ): string {\n        key = key || false;\n        if ( key ) {\n            return ((window.sessionStorage[x].length * 2) / 1024 / 1024).toFixed(2);\n        }\n        else {\n            var total = 0;\n            for ( var x in window.sessionStorage ) {\n                total += (window.sessionStorage[x].length * 2) / 1024 / 1024;\n            }\n            return total.toFixed(2);\n        }\n    }\n\n    cookieRegistry: any[] = [];\n\n    protected listenCookieChange( cookieName, callback ) {\n        setInterval(() => {\n            if ( this.hasItem(cookieName) ) {\n                if ( this.getItem(cookieName) != this.cookieRegistry[cookieName] ) {\n                    // update registry so we dont get triggered again\n                    this.cookieRegistry[cookieName] = this.getItem(cookieName);\n                    return callback();\n                }\n            }\n            else {\n                this.cookieRegistry[cookieName] = this.getItem(cookieName);\n            }\n        }, 100);\n    }\n\n\n    onStoreEvent( callback: Function ) {\n        this.keys().forEach(( name: string ) => {\n            this.listenCookieChange(name, callback);\n        })\n    }\n\n    clear(): void {\n        this.keys().forEach(( name: string )=> {\n            this.removeItem(name);\n        })\n    }\n\n    key( index: number ): string {\n        return this.keys()[index];\n    }\n\n\n    getItem( sKey ) {\n        if ( !sKey ) {\n            return null;\n        }\n        return decodeURIComponent(document.cookie.replace(new RegExp(\"(?:(?:^|.*;)\\\\s*\" + encodeURIComponent(sKey).replace(/[\\-\\.\\+\\*]/g, \"\\\\$&\") + \"\\\\s*\\\\=\\\\s*([^;]*).*$)|^.*$\"), \"$1\")) || null;\n    }\n\n    setItem( sKey: any, sValue: any, vEnd?: any, sPath?: any, sDomain?: any, bSecure?: any ): void {\n        if ( !sKey || /^(?:expires|max\\-age|path|domain|secure)$/i.test(sKey) ) {\n            return;\n        }\n        var sExpires = \"\";\n        if ( vEnd ) {\n            switch ( vEnd.constructor ) {\n                case Number:\n                    sExpires = vEnd === Infinity ? \"; expires=Fri, 31 Dec 9999 23:59:59 GMT\" : \"; max-age=\" + vEnd;\n                    break;\n                case String:\n                    sExpires = \"; expires=\" + vEnd;\n                    break;\n                case Date:\n                    sExpires = \"; expires=\" + vEnd.toUTCString();\n                    break;\n            }\n        }\n        document.cookie = encodeURIComponent(sKey) + \"=\" + encodeURIComponent(sValue) + sExpires + (sDomain ? \"; domain=\" + sDomain : \"\") + (sPath ? \"; path=\" + sPath : \"\") + (bSecure ? \"; secure\" : \"\");\n        return;\n    }\n\n\n    removeItem( key: string, sPath?: any, sDomain?: any ) {\n        if ( !this.hasItem(key) ) {\n            return false;\n        }\n        document.cookie = encodeURIComponent(key) + \"=; expires=Thu, 01 Jan 1970 00:00:00 GMT\" + (sDomain ? \"; domain=\" + sDomain : \"\") + (sPath ? \"; path=\" + sPath : \"\");\n        return true;\n    }\n\n    hasItem( sKey ) {\n        if ( !sKey ) {\n            return false;\n        }\n        return (new RegExp(\"(?:^|;\\\\s*)\" + encodeURIComponent(sKey).replace(/[\\-\\.\\+\\*]/g, \"\\\\$&\") + \"\\\\s*\\\\=\")).test(document.cookie);\n    }\n\n    keys() {\n        var aKeys = document.cookie.replace(/((?:^|\\s*;)[^\\=]+)(?=;|$)|^\\s*|\\s*(?:\\=[^;]*)?(?:\\1|$)/g, \"\").split(/\\s*(?:\\=[^;]*)?;\\s*/);\n        for ( var nLen = aKeys.length, nIdx = 0; nIdx < nLen; nIdx++ ) {\n            aKeys[nIdx] = decodeURIComponent(aKeys[nIdx]);\n        }\n        return aKeys;\n    }\n\n}\n\n\n"]}